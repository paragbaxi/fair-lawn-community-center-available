name: Push Notify

on:
  schedule:
    # Every 30 minutes from 8 AM to 10 PM UTC (covers 8 AM–10 PM ET + buffer)
    # The script itself enforces the 8 AM–10 PM ET gate
    - cron: '*/30 12-02 * * *'
  workflow_dispatch:

permissions:
  contents: read

concurrency:
  group: push-notify
  cancel-in-progress: false

jobs:
  notify:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - uses: ./.github/actions/setup-node-deps

      - name: Run check-and-notify
        env:
          CLOUDFLARE_WORKER_URL: ${{ secrets.CLOUDFLARE_WORKER_URL }}
          NOTIFY_API_KEY: ${{ secrets.NOTIFY_API_KEY }}
        run: node scripts/check-and-notify.mjs
